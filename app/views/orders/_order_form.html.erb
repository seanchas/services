<%- form_for @order, :url => @order.new_record? ? :orders : order_path(@order), :html => { :id => :order_form } do |f| -%>

    <%= render "order_form_errors" %>

    <%= render :partial => "order_form_blocks" %>

    <%= render :partial => "order_form_fields", :locals => { :f => f } %>

    <%= render :partial => "#{@order.new_record? ? :new : :edit}_order_form_submit", :locals => { :f => f } %>
    
<%- end -%>

<script type="text/javascript" charset="utf-8">
    document.observe("dom:loaded", function(e) {
        $$("input[data-format=calendar]").each(function(input) {
            input.hide();
            var view = new Element('span', { 'class': 'calendar_view' });
            input.insert({before: view});
            new Calendar(view, input, { view_format: 'order_form' });
        });
        
        $('order_form').on('change', function(e) {
            new Ajax.Request($('order_form').readAttribute('action'), {
                parameters: $('order_form').serialize()
            });
        });
    });
</script>
